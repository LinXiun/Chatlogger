--// Fast Chat Logger GUI (LocalScript)
--// Place this in StarterPlayerScripts

-- Services
local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local TweenService = game:GetService("TweenService")

local localPlayer = Players.LocalPlayer
local playerGui = localPlayer:WaitForChild("PlayerGui")

--=== Create GUI Hierarchy Fast ===--
local gui = Instance.new("ScreenGui")
gui.Name = "ChatLoggerGui"
gui.ResetOnSpawn = false
gui.Parent = playerGui

local main = Instance.new("Frame")
main.Size = UDim2.new(0, 500, 0, 350)
main.Position = UDim2.new(0.5, -250, 0.5, -175)
main.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
main.BorderSizePixel = 0
main.Parent = gui
Instance.new("UICorner", main).CornerRadius = UDim.new(0, 12)

local playerList = Instance.new("ScrollingFrame")
playerList.Size = UDim2.new(0, 150, 1, 0)
playerList.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
playerList.BorderSizePixel = 0
playerList.ScrollBarThickness = 6
playerList.Parent = main
local listLayout = Instance.new("UIListLayout")
listLayout.Padding = UDim.new(0, 4)
listLayout.Parent = playerList

local chatFrame = Instance.new("ScrollingFrame")
chatFrame.Size = UDim2.new(1, -160, 1, -10)
chatFrame.Position = UDim2.new(0, 155, 0, 5)
chatFrame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
chatFrame.BorderSizePixel = 0
chatFrame.ScrollBarThickness = 8
chatFrame.AutomaticCanvasSize = Enum.AutomaticSize.Y
chatFrame.Parent = main
local chatLayout = Instance.new("UIListLayout")
chatLayout.Padding = UDim.new(0, 4)
chatLayout.SortOrder = Enum.SortOrder.LayoutOrder
chatLayout.Parent = chatFrame

-- Scroll-to-bottom button
local scrollBtn = Instance.new("TextButton")
scrollBtn.Size = UDim2.new(0, 140, 0, 32)
scrollBtn.Position = UDim2.new(1, -160, 1, -45)
scrollBtn.BackgroundColor3 = Color3.fromRGB(70, 130, 180)
scrollBtn.TextColor3 = Color3.new(1, 1, 1)
scrollBtn.Font = Enum.Font.SourceSansBold
scrollBtn.TextSize = 16
scrollBtn.Text = "Scroll to Bottom ↓"
scrollBtn.Visible = false
scrollBtn.BackgroundTransparency = 1
scrollBtn.TextTransparency = 1
scrollBtn.Parent = main
Instance.new("UICorner", scrollBtn).CornerRadius = UDim.new(0, 8)

--=== Functions ===--
local playerColors = {}
local function getPlayerColor(plr)
	local color = playerColors[plr.UserId]
	if not color then
		color = Color3.fromHSV(math.random(), 0.6, 1)
		playerColors[plr.UserId] = color
	end
	return color
end

local function fadeButton(show)
	local target = {
		BackgroundTransparency = show and 0 or 1,
		TextTransparency = show and 0 or 1,
	}
	local tween = TweenService:Create(scrollBtn, TweenInfo.new(0.2), target)
	if show and not scrollBtn.Visible then
		scrollBtn.Visible = true
	end
	tween:Play()
	tween.Completed:Once(function()
		if not show then
			scrollBtn.Visible = false
		end
	end)
end

-- Update player list (fast version)
local function updatePlayerList()
	playerList:ClearAllChildren()
	for _, plr in ipairs(Players:GetPlayers()) do
		local b = Instance.new("TextButton")
		b.Size = UDim2.new(1, -10, 0, 25)
		b.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
		b.TextColor3 = Color3.new(1, 1, 1)
		b.Text = plr.DisplayName
		b.Font = Enum.Font.SourceSansBold
		b.TextSize = 16
		b.AutoButtonColor = false
		Instance.new("UICorner", b).CornerRadius = UDim.new(0, 8)
		b.Parent = playerList
	end
end
updatePlayerList()
Players.PlayerAdded:Connect(updatePlayerList)
Players.PlayerRemoving:Connect(updatePlayerList)

-- Chat template (prebuilt for reuse)
local function createChatLabel()
	local t = Instance.new("TextLabel")
	t.BackgroundTransparency = 1
	t.Size = UDim2.new(1, -10, 0, 20)
	t.Font = Enum.Font.SourceSans
	t.TextXAlignment = Enum.TextXAlignment.Left
	t.TextSize = 16
	t.TextWrapped = true
	t.RichText = true
	t.TextColor3 = Color3.new(1, 1, 1)
	return t
end

local buttonVisible = false
local function updateScrollButton()
	local gap = chatFrame.AbsoluteCanvasSize.Y - (chatFrame.CanvasPosition.Y + chatFrame.AbsoluteWindowSize.Y)
	local shouldShow = gap > 20
	if shouldShow ~= buttonVisible then
		buttonVisible = shouldShow
		fadeButton(shouldShow)
	end
end

-- Add chat message (optimized)
local function addChatMessage(player, message)
	message = message:gsub("#", "")
	local color = getPlayerColor(player)
	local prefix = string.format('<font color="rgb(%d,%d,%d)">%s</font>', color.R*255, color.G*255, color.B*255, player.DisplayName)
	local line = createChatLabel()
	line.Text = string.format("[%s] %s: %s", os.date("%H:%M:%S"), prefix, message)

	local atBottom = chatFrame.CanvasPosition.Y + chatFrame.AbsoluteWindowSize.Y >= chatFrame.AbsoluteCanvasSize.Y - 5
	line.Parent = chatFrame

	if atBottom then
		task.defer(function()
			chatFrame.CanvasPosition = Vector2.new(0, chatFrame.AbsoluteCanvasSize.Y)
		end)
	end
end

chatFrame:GetPropertyChangedSignal("CanvasPosition"):Connect(updateScrollButton)
chatFrame:GetPropertyChangedSignal("AbsoluteCanvasSize"):Connect(updateScrollButton)

scrollBtn.MouseButton1Click:Connect(function()
	local tween = TweenService:Create(chatFrame, TweenInfo.new(0.25, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
		CanvasPosition = Vector2.new(0, chatFrame.AbsoluteCanvasSize.Y)
	})
	tween:Play()
end)

-- Hook Roblox chat event
local ChatEvent = ReplicatedStorage:FindFirstChild("DefaultChatSystemChatEvents")
if ChatEvent and ChatEvent:FindFirstChild("OnMessageDoneFiltering") then
	ChatEvent.OnMessageDoneFiltering.OnClientEvent:Connect(function(data)
		local sender = Players:FindFirstChild(data.FromSpeaker)
		if sender then
			addChatMessage(sender, data.Message)
			updateScrollButton()
		end
	end)
end

print("[ChatLogger] Loaded instantly ⚡")