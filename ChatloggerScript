-- ðŸŒ™ Chat Logger (Transparent, Filterable, Draggable, Spectate/Teleport)
local Players = game:GetService("Players")
local TextChatService = game:GetService("TextChatService")
local TweenService = game:GetService("TweenService")
local player = Players.LocalPlayer
local camera = workspace.CurrentCamera

-- UI Setup
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "ChatLoggerGui"
screenGui.ResetOnSpawn = false
screenGui.Parent = player:WaitForChild("PlayerGui")

local mainFrame = Instance.new("Frame")
mainFrame.Size = UDim2.new(0, 360, 0, 320)
mainFrame.Position = UDim2.new(0, 10, 0, 10)
mainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
mainFrame.BackgroundTransparency = 0.6
mainFrame.BorderSizePixel = 0
mainFrame.Active = true
mainFrame.Draggable = true
mainFrame.Parent = screenGui
Instance.new("UICorner", mainFrame).CornerRadius = UDim.new(0, 8)

-- Header
local header = Instance.new("Frame")
header.Size = UDim2.new(1, 0, 0, 28)
header.BackgroundTransparency = 1
header.Parent = mainFrame

local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -140, 1, 0)
title.Position = UDim2.new(0, 8, 0, 0)
title.BackgroundTransparency = 1
title.Text = "Chat Logger"
title.TextColor3 = Color3.fromRGB(220, 220, 220)
title.Font = Enum.Font.SourceSansBold
title.TextSize = 16
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = header

-- Buttons
local returnBtn = Instance.new("TextButton")
returnBtn.Size = UDim2.new(0, 24, 0, 24)
returnBtn.Position = UDim2.new(1, -60, 0, 2)
returnBtn.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
returnBtn.BackgroundTransparency = 0.4
returnBtn.BorderSizePixel = 0
returnBtn.Text = "âŸ³"
returnBtn.Font = Enum.Font.SourceSansBold
returnBtn.TextSize = 18
returnBtn.TextColor3 = Color3.fromRGB(240, 240, 240)
returnBtn.Parent = header
Instance.new("UICorner", returnBtn).CornerRadius = UDim.new(0, 6)

local hideBtn = Instance.new("TextButton")
hideBtn.Size = UDim2.new(0, 20, 0, 20)
hideBtn.Position = UDim2.new(1, -24, 0, 4)
hideBtn.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
hideBtn.BackgroundTransparency = 0.4
hideBtn.BorderSizePixel = 0
hideBtn.Text = "v"
hideBtn.Font = Enum.Font.SourceSansBold
hideBtn.TextSize = 14
hideBtn.TextColor3 = Color3.fromRGB(240, 240, 240)
hideBtn.Parent = header
Instance.new("UICorner", hideBtn).CornerRadius = UDim.new(0, 6)

local unhideBtn = Instance.new("TextButton")
unhideBtn.Size = UDim2.new(0, 30, 0, 30)
unhideBtn.Position = UDim2.new(0, 10, 0, 10)
unhideBtn.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
unhideBtn.BackgroundTransparency = 0.4
unhideBtn.BorderSizePixel = 0
unhideBtn.Text = "^"
unhideBtn.Font = Enum.Font.SourceSansBold
unhideBtn.TextSize = 18
unhideBtn.TextColor3 = Color3.fromRGB(240, 240, 240)
unhideBtn.Visible = false
unhideBtn.Active = true
unhideBtn.Draggable = true
unhideBtn.Parent = screenGui
Instance.new("UICorner", unhideBtn).CornerRadius = UDim.new(0, 6)

hideBtn.MouseButton1Click:Connect(function()
	mainFrame.Visible = false
	unhideBtn.Visible = true
end)
unhideBtn.MouseButton1Click:Connect(function()
	mainFrame.Visible = true
	unhideBtn.Visible = false
end)

-- Dropdown frame (left)
local dropdownFrame = Instance.new("Frame")
dropdownFrame.Size = UDim2.new(0, 130, 1, -36)
dropdownFrame.Position = UDim2.new(0, 0, 0, 36)
dropdownFrame.BackgroundColor3 = Color3.fromRGB(25, 25, 25)
dropdownFrame.BackgroundTransparency = 0.6
dropdownFrame.BorderSizePixel = 0
dropdownFrame.Visible = true
dropdownFrame.Parent = mainFrame
Instance.new("UICorner", dropdownFrame).CornerRadius = UDim.new(0, 8)

local dropdownList = Instance.new("ScrollingFrame")
dropdownList.Size = UDim2.new(1, 0, 1, 0)
dropdownList.CanvasSize = UDim2.new(0, 0, 0, 0)
dropdownList.BackgroundTransparency = 1
dropdownList.BorderSizePixel = 0
dropdownList.ScrollBarThickness = 6
dropdownList.Parent = dropdownFrame
local listLayout = Instance.new("UIListLayout")
listLayout.Parent = dropdownList

-- Chat frame (dynamic)
local scrollFrame = Instance.new("ScrollingFrame")
scrollFrame.Size = UDim2.new(1, -140, 1, -36)
scrollFrame.Position = UDim2.new(0, 140, 0, 36)
scrollFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
scrollFrame.BackgroundTransparency = 0.6
scrollFrame.BorderSizePixel = 0
scrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
scrollFrame.ScrollBarThickness = 6
scrollFrame.Parent = mainFrame
Instance.new("UICorner", scrollFrame).CornerRadius = UDim.new(0, 8)
local layout = Instance.new("UIListLayout")
layout.SortOrder = Enum.SortOrder.LayoutOrder
layout.Padding = UDim.new(0, 4)
layout.Parent = scrollFrame

-- Spectate/Teleport logic
local spectateLabel = Instance.new("TextLabel")
spectateLabel.Size = UDim2.new(0, 180, 0, 20)
spectateLabel.Position = UDim2.new(0, 110, 0, 4)
spectateLabel.BackgroundTransparency = 1
spectateLabel.Font = Enum.Font.SourceSansItalic
spectateLabel.TextSize = 14
spectateLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
spectateLabel.Text = ""
spectateLabel.TextXAlignment = Enum.TextXAlignment.Left
spectateLabel.Parent = header

local function spectatePlayer(name)
	local target = Players:FindFirstChild(name)
	if target and target.Character then
		local hum = target.Character:FindFirstChildOfClass("Humanoid")
		if hum then
			camera.CameraSubject = hum
			camera.CameraType = Enum.CameraType.Custom
			spectateLabel.Text = "Spectating: " .. target.DisplayName
		end
	end
end

local function returnToLocal()
	local char = player.Character
	if char then
		local hum = char:FindFirstChildOfClass("Humanoid")
		if hum then
			camera.CameraSubject = hum
			camera.CameraType = Enum.CameraType.Custom
			spectateLabel.Text = ""
		end
	end
end
returnBtn.MouseButton1Click:Connect(returnToLocal)

local function teleportToPlayer(name)
	local target = Players:FindFirstChild(name)
	if target and target.Character and target.Character:FindFirstChild("HumanoidRootPart") then
		local targetHRP = target.Character.HumanoidRootPart
		local char = player.Character or player.CharacterAdded:Wait()
		local hrp = char:WaitForChild("HumanoidRootPart", 2)
		if not hrp then return end

		hrp.CFrame = CFrame.new(targetHRP.Position + Vector3.new(0, 4, 0))

		local flash = Instance.new("Frame")
		flash.Size = UDim2.new(1, 0, 1, 0)
		flash.BackgroundColor3 = Color3.fromRGB(0, 255, 0)
		flash.BackgroundTransparency = 0.5
		flash.BorderSizePixel = 0
		flash.ZIndex = 999
		flash.Parent = screenGui
		TweenService:Create(flash, TweenInfo.new(0.4), {BackgroundTransparency = 1}):Play()
		task.delay(0.5, function() flash:Destroy() end)
	end
end

-- Timestamp & color functions
local function formatTime()
	local now = os.time()
	local utc8 = os.date("!*t", now + 8*3600)
	local hour = utc8.hour % 12
	if hour == 0 then hour = 12 end
	return string.format("%d:%02d%s", hour, utc8.min, utc8.hour >= 12 and "PM" or "AM")
end
local function getColorForName(n)
	local h = 0 for i = 1, #n do h = (h * 31 + string.byte(n, i)) % 360 end
	return Color3.fromHSV(h / 360, 0.55, 0.9)
end

-- Filter system
local filters = {}
local messages = {}
local showAll = true

local function addMessage(text, displayName, username)
	local f = Instance.new("Frame")
	f.Size = UDim2.new(1, -10, 0, 0)
	f.BackgroundTransparency = 1
	f.AutomaticSize = Enum.AutomaticSize.Y
	f.Parent = scrollFrame

	local ts = Instance.new("TextLabel")
	ts.Size = UDim2.new(0, 60, 0, 18)
	ts.BackgroundTransparency = 1
	ts.Font = Enum.Font.Code
	ts.TextSize = 14
	ts.TextColor3 = Color3.fromRGB(160, 160, 160)
	ts.Text = formatTime()
	ts.TextXAlignment = Enum.TextXAlignment.Left
	ts.Parent = f

	local nameBtn = Instance.new("TextButton")
	nameBtn.Size = UDim2.new(0, 120, 0, 0)
	nameBtn.Position = UDim2.new(0, 60, 0, 0)
	nameBtn.BackgroundTransparency = 1
	nameBtn.AutoButtonColor = false
	nameBtn.Font = Enum.Font.SourceSansBold
	nameBtn.TextSize = 18
	nameBtn.TextColor3 = getColorForName(username)
	nameBtn.TextXAlignment = Enum.TextXAlignment.Left
	nameBtn.Text = displayName
	nameBtn.AutomaticSize = Enum.AutomaticSize.Y
	nameBtn.Parent = f

	local clickCount, lastClick = 0, 0
	nameBtn.MouseButton1Click:Connect(function()
		local now = tick()
		clickCount = (now - lastClick < 0.6) and clickCount + 1 or 1
		lastClick = now
		if clickCount == 1 then
			spectatePlayer(username)
		elseif clickCount == 3 then
			clickCount = 0
			teleportToPlayer(username)
		end
	end)

	local msgBtn = Instance.new("TextButton")
	msgBtn.Size = UDim2.new(1, -180, 0, 0)
	msgBtn.Position = UDim2.new(0, 180, 0, 0)
	msgBtn.BackgroundTransparency = 1
	msgBtn.TextWrapped = true
	msgBtn.Font = Enum.Font.SourceSans
	msgBtn.TextSize = 18
	msgBtn.TextColor3 = Color3.fromRGB(230, 230, 230)
	msgBtn.TextXAlignment = Enum.TextXAlignment.Left
	msgBtn.Text = text
	msgBtn.AutomaticSize = Enum.AutomaticSize.Y
	msgBtn.Parent = f
end

local function rebuildMessages()
	scrollFrame:ClearAllChildren()
	layout.Parent = scrollFrame
	for _, m in ipairs(messages) do
		if showAll or filters[m.username] then
			addMessage(m.text, m.displayName, m.username)
		end
	end
	scrollFrame.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y + 8)
end

local function refreshDropdown()
	for _, c in ipairs(dropdownList:GetChildren()) do
		if c:IsA("TextButton") then c:Destroy() end
	end

	local function addBtn(txt, username)
		local btn = Instance.new("TextButton")
		btn.Size = UDim2.new(1, -6, 0, 26)
		btn.BackgroundColor3 = filters[username] and Color3.fromRGB(0, 200, 0) or Color3.fromRGB(60, 60, 60)
		btn.BackgroundTransparency = 0.4
		btn.TextColor3 = Color3.fromRGB(240, 240, 240)
		btn.Text = txt
		btn.Font = Enum.Font.SourceSansBold
		btn.TextSize = 16
		btn.BorderSizePixel = 0
		btn.Parent = dropdownList
		Instance.new("UICorner", btn).CornerRadius = UDim.new(0, 6)
		btn.MouseButton1Click:Connect(function()
			if username == "ALL" then
				showAll = true
				filters = {}
			else
				showAll = false
				filters[username] = not filters[username]
			end
			refreshDropdown()
			rebuildMessages()
		end)
	end

	addBtn("All", "ALL")
	for _, p in ipairs(Players:GetPlayers()) do
		addBtn(p.DisplayName, p.Name)
	end
	dropdownList.CanvasSize = UDim2.new(0, 0, 0, listLayout.AbsoluteContentSize.Y)
end

Players.PlayerAdded:Connect(refreshDropdown)
Players.PlayerRemoving:Connect(refreshDropdown)

-- New message indicator
local newMsgBtn = Instance.new("TextButton")
newMsgBtn.Size = UDim2.new(0, 160, 0, 26)
newMsgBtn.AnchorPoint = Vector2.new(0.5, 1)
newMsgBtn.Position = UDim2.new(0.5, 0, 1, -6)
newMsgBtn.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
newMsgBtn.BackgroundTransparency = 0.5
newMsgBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
newMsgBtn.Font = Enum.Font.SourceSansBold
newMsgBtn.TextSize = 14
newMsgBtn.Text = "New messages below â†“"
newMsgBtn.BorderSizePixel = 0
newMsgBtn.Visible = false
newMsgBtn.Parent = mainFrame
Instance.new("UICorner", newMsgBtn).CornerRadius = UDim.new(0, 6)

newMsgBtn.MouseButton1Click:Connect(function()
	scrollFrame.CanvasPosition = Vector2.new(0, scrollFrame.CanvasSize.Y.Offset)
	newMsgBtn.Visible = false
end)

scrollFrame:GetPropertyChangedSignal("CanvasPosition"):Connect(function()
	local maxScroll = scrollFrame.CanvasSize.Y.Offset - scrollFrame.AbsoluteWindowSize.Y
	if scrollFrame.CanvasPosition.Y < maxScroll - 40 then
		newMsgBtn.Visible = true
	else
		newMsgBtn.Visible = false
	end
end)

-- Hook chat messages
TextChatService.MessageReceived:Connect(function(msg)
	local src = msg.TextSource
	if not src then return end
	local sender = Players:GetPlayerByUserId(src.UserId)
	if not sender then return end
	local m = {text = msg.Text, displayName = sender.DisplayName, username = sender.Name}
	table.insert(messages, m)
	if showAll or filters[m.username] then
		addMessage(m.text, m.displayName, m.username)
	end
	scrollFrame.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y + 8)
end)

-- Initialize
refreshDropdown()
rebuildMessages()