-- Flash Sidestep with Camera Lock
-- Place in StarterPlayerScripts (LocalScript)

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local camera = workspace.CurrentCamera
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRoot = character:WaitForChild("HumanoidRootPart")
local humanoid = character:WaitForChild("Humanoid")

-- CONFIG
local DashDistance = 60     -- sidestep distance
local DashTime = 0.08       -- sidestep speed
local Interval = 0.1        -- time between left/right steps
local active = true         -- whether sidestep is active

-- Store default camera settings
local defaultCameraType = camera.CameraType
local defaultCameraSubject = camera.CameraSubject

-- Flash Trail Effect (optional)
local function createTrail()
	local trail = Instance.new("Trail")
	trail.Lifetime = 0.1
	trail.Transparency = NumberSequence.new(0.2, 1)
	trail.Color = ColorSequence.new(Color3.fromRGB(255, 0, 0), Color3.fromRGB(255, 150, 0))

	local a0 = Instance.new("Attachment", humanoidRoot)
	local a1 = Instance.new("Attachment", humanoidRoot)
	a0.Position = Vector3.new(0, 2, 0)
	a1.Position = Vector3.new(0, -2, 0)

	trail.Attachment0 = a0
	trail.Attachment1 = a1
	trail.Parent = humanoidRoot

	game.Debris:AddItem(trail, 0.25)
end

-- Lock camera at current position
local function lockCamera()
	local fixedCFrame = camera.CFrame
	camera.CameraType = Enum.CameraType.Scriptable
	RunService:BindToRenderStep("LockCamera", Enum.RenderPriority.Camera.Value, function()
		camera.CFrame = fixedCFrame
	end)
end

-- Unlock camera to default behavior
local function unlockCamera()
	RunService:UnbindFromRenderStep("LockCamera")
	camera.CameraType = defaultCameraType
	camera.CameraSubject = defaultCameraSubject
end

-- Sidestep alternating left/right
local function sidestepLoop()
	local dir = -1
	lockCamera() -- freeze camera during sidestep
	while active do
		-- Stop if player moves manually (joystick or keys)
		if humanoid.MoveDirection.Magnitude > 0 then
			active = false
			break
		end

		dir = -dir -- alternate left/right
		createTrail()

		local moveDir = humanoidRoot.CFrame.RightVector * dir
		local targetPos = humanoidRoot.Position + moveDir * DashDistance

		local tween = TweenService:Create(
			humanoidRoot,
			TweenInfo.new(DashTime, Enum.EasingStyle.Linear),
			{CFrame = CFrame.new(targetPos, targetPos + humanoidRoot.CFrame.LookVector)}
		)
		tween:Play()
		tween.Completed:Wait()

		task.wait(Interval)
	end
	unlockCamera() -- restore camera after sidestep ends
end

-- Run automatically when character loads
task.defer(function()
	task.wait(1)
	sidestepLoop()
end)

-- Reapply behavior on respawn
player.CharacterAdded:Connect(function(newChar)
	character = newChar
	humanoidRoot = newChar:WaitForChild("HumanoidRootPart")
	humanoid = newChar:WaitForChild("Humanoid")
	active = true
	task.wait(1)
	sidestepLoop()
end)